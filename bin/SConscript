#!python
import os
Import('env')
if not env.GetOption('clean'):
        env.Append(LIBS    = "oxsx")
        env.Append(LIBPATH = "#/build")
        includes  = " ".join(["-I" + Dir(x).abspath for x in env["CPPPATH"]])
        lib_paths = " ".join(["-L" + Dir(x).abspath for x in env["LIBPATH"]])
        libs      = " ".join(["-l" + x  for x in env["LIBS"]])
        if env["SYSTEM"] == "Darwin":
                link_flags = " -Wl," + ",".join(env["LINKFLAGS"])
	else:
                link_flags = " -Wl," + ",".join("-rpath,{0}".format(x) for x in env["RPATH"])
        with os.fdopen(
                os.open("compile.sh", os.O_RDWR | os.O_CREAT, 0755) , "w") as f:
            f.write(
                        ''' # This file is auto generated by scons
g++ $1 -o $(basename "$1" .cpp) -O2 {0} {1} {2} {3}
'''.format(includes, lib_paths, libs, link_flags)
                        )
